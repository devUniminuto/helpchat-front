{"ast":null,"code":"import FullBoxVue from \"../components/static/FullBox.vue\";\nimport MiddleBox from \"@/components/static/MiddleBox.vue\";\nimport searchUserMultipleVue from \"../components/searchUserMultiple.vue\";\nimport { getPeticion, getCandidatos, downloadFile, getArchivos, subirArchivos, eliminarArchivos, getFunProv, updateEncargadoSolicitud, getEstadosPeticiones, updateEstadoSolicitud } from \"@/api\";\nexport default {\n  data() {\n    return {\n      infoSolicitud: {},\n      infoSolicitudCandidatos: {},\n      componentKey: 1,\n      estadoSolicitud: null,\n      estados: null,\n      idSolicitud: this.$route.params.id,\n      archivosSubidos: [],\n      Images: null,\n      valido: false,\n      userSearchSelected: [],\n      userSearch: []\n    };\n  },\n  components: {\n    FullBoxVue,\n    MiddleBox,\n    searchUserMultipleVue\n  },\n  methods: {\n    actualizarEncargado() {\n      let bodySol = {\n        idEncargado: this.userSearchSelected,\n        idSolicitud: this.idSolicitud\n      };\n      updateEncargadoSolicitud(bodySol).then(function (response) {}.bind(this));\n    },\n    actualizarEstadoSolicitud() {\n      let bodySol = {\n        idEstado: this.estadoSolicitud,\n        idSolicitud: this.idSolicitud\n      };\n      updateEstadoSolicitud(bodySol).then(function (response) {}.bind(this));\n    },\n    userSearchSelectedFunc(values) {\n      this.userSearchSelected = values;\n    },\n    uploadFile() {\n      this.Images = this.$refs.file.files[0];\n    },\n    eliminarArchivo(id) {\n      eliminarArchivos(id).then(function (response) {\n        console.log(response.data);\n        this.realizarConsultaArchivos();\n      }.bind(this));\n    },\n    realizarConsulta() {\n      getPeticion(this.idSolicitud).then(function (response) {\n        this.infoSolicitud = response.data;\n        this.estadoSolicitud = this.infoSolicitud.idEstado;\n        this.componentKey += 1;\n      }.bind(this));\n    },\n    realizarConsultaEstados() {\n      getEstadosPeticiones().then(function (response) {\n        this.estados = response.data;\n      }.bind(this));\n    },\n    realizarConsultaCandidatos() {\n      getCandidatos(this.idSolicitud).then(function (response) {\n        this.infoSolicitudCandidatos = response.data;\n        this.componentKey += 1;\n      }.bind(this));\n    },\n    realizarConsultaArchivos() {\n      getArchivos(this.idSolicitud).then(function (response) {\n        this.archivosSubidos = response.data;\n      }.bind(this));\n    },\n    subirArchivo() {\n      const formData = new FormData();\n      formData.append(\"file\", this.Images);\n      formData.append(\"idSolicitud\", this.idSolicitud);\n      subirArchivos(formData).then(function (response) {\n        const Toast = this.$swal.mixin({\n          toast: true,\n          position: \"top-end\",\n          showConfirmButton: false,\n          timer: 3000,\n          timerProgressBar: true,\n          didOpen: toast => {\n            toast.addEventListener(\"mouseenter\", this.$swal.stopTimer);\n            toast.addEventListener(\"mouseleave\", this.$swal.resumeTimer);\n          }\n        });\n        Toast.fire({\n          icon: \"success\",\n          title: \"Solicitud enviada exitosamente\"\n        });\n        this.realizarConsultaArchivos();\n      }.bind(this));\n    },\n    descargarArchivos(filepath) {\n      downloadFile(filepath).then(response => {\n        console.log(response.data);\n        let fileName = filepath.split(\"/\")[3];\n        const url = window.URL.createObjectURL(new Blob([response.data]));\n        const link = document.createElement(\"a\");\n        link.href = url;\n        link.setAttribute(\"download\", fileName);\n        document.body.appendChild(link);\n        link.click();\n      });\n    }\n  },\n  mounted() {\n    getFunProv().then(function (response) {\n      this.userSearch = response.data;\n    }.bind(this));\n    this.realizarConsulta();\n  },\n  watch: {\n    infoSolicitud(newState) {\n      if (newState != {}) {\n        this.valido = true;\n        this.realizarConsultaCandidatos();\n        this.realizarConsultaArchivos();\n        this.realizarConsultaEstados();\n      }\n    }\n  }\n};","map":{"version":3,"mappings":"AA8OA;AACA;AACA;AAEA,SACAA,aACAC,eACAC,cACAC,aACAC,eACAC,kBACAC,YACAC,0BACAC,sBACAC,6BACA;AAEA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EAEAC;IACAC;IACAC;IACAC;EACA;EAEAC;IACAC;MACA;QACAC;QACAZ;MACA;MACAT;IACA;IAEAsB;MACA;QACAC;QACAd;MACA;MACAP;IACA;IAEAsB;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MACA5B,0BACA;QACA6B;QACA;MACA,aACA;IACA;IAEAC;MACAnC,mCACA;QACA;QACA;QACA;MACA,aACA;IACA;IAEAoC;MACA5B,4BACA;QACA;MACA,aACA;IACA;IAEA6B;MACApC,qCACA;QACA;QACA;MACA,aACA;IACA;IAEAqC;MACAnC,mCACA;QACA;MACA,aACA;IACA;IAEAoC;MACA;MACAC;MACAA;MAEApC,6BACA;QACA;UACAqC;UACAC;UACAC;UACAC;UACAC;UACAC;YACAL;YACAA;UACA;QACA;QACAM;UACAC;UACAC;QACA;QACA;MACA,aACA;IACA;IAEAC;MACAhD;QACAgC;QACA;QACA;QACA;QACAiB;QACAA;QACAC;QACAD;MACA;IACA;EACA;EAEAE;IACA/C,kBACA;MACA;IACA,aACA;IACA;EACA;EAEAgD;IACA3C;MACA;QACA;QACA;QACA;QACA;MACA;IACA;EACA;AACA","names":["getPeticion","getCandidatos","downloadFile","getArchivos","subirArchivos","eliminarArchivos","getFunProv","updateEncargadoSolicitud","getEstadosPeticiones","updateEstadoSolicitud","data","infoSolicitud","infoSolicitudCandidatos","componentKey","estadoSolicitud","estados","idSolicitud","archivosSubidos","Images","valido","userSearchSelected","userSearch","components","FullBoxVue","MiddleBox","searchUserMultipleVue","methods","actualizarEncargado","idEncargado","actualizarEstadoSolicitud","idEstado","userSearchSelectedFunc","uploadFile","eliminarArchivo","console","realizarConsulta","realizarConsultaEstados","realizarConsultaCandidatos","realizarConsultaArchivos","subirArchivo","formData","toast","position","showConfirmButton","timer","timerProgressBar","didOpen","Toast","icon","title","descargarArchivos","link","document","mounted","watch"],"sourceRoot":"src/views","sources":["infoSolicitudView.vue"],"sourcesContent":["<template>\n  <div :key=\"componentKey\" v-if=\"valido\">\n    <FullBoxVue class=\"shadowHover\">\n      <h1>Solicitud {{ $route.params.id }}</h1>\n    </FullBoxVue>\n    <FullBoxVue class=\"shadowHover\" v-if=\"$dataUser[0].rol == 'Admin'\">\n      Encargado(s) actual: {{ infoSolicitud.encargados }}\n      <h2>Seleccionar analista</h2>\n      <searchUserMultipleVue\n        v-bind:people=\"userSearch\"\n        @selected=\"userSearchSelectedFunc\"\n      ></searchUserMultipleVue>\n      <v-btn color=\"success\" @click=\"actualizarEncargado()\"\n        >Actualizar analista</v-btn\n      >\n      <br /><br />\n      <h2>Cambiar estado solicitud</h2>\n      <v-select\n        v-model=\"estadoSolicitud\"\n        :items=\"estados\"\n        item-text=\"nombre\"\n        item-value=\"id\"\n        label=\"Estado\"\n      ></v-select>\n      <v-btn color=\"success\" @click=\"actualizarEstadoSolicitud()\"\n        >Actualizar Estado de solicitud</v-btn\n      >\n    </FullBoxVue>\n    <FullBoxVue\n      class=\"shadowHover\"\n      v-if=\"\n        $dataUser[0].idRol == 3 ||\n        infoSolicitud.idEncargado == $dataUser[0].id ||\n        infoSolicitud.encargado == $dataUser[0].id ||\n        infoSolicitud.estado == 'Finalizada'\n      \"\n    >\n\n      <div\n        v-if=\"\n          $dataUser[0].idRol == 3 ||\n          infoSolicitud.encargado == $dataUser[0].id\n        \"\n      >\n        <h2>Subir archivo nuevo</h2>\n        <input type=\"file\" @change=\"uploadFile\" ref=\"file\" />\n        &nbsp;\n        <v-btn color=\"success\" @click=\"subirArchivo()\">Subir archivo</v-btn>\n        <br /><br />\n      </div>\n\n      <v-container>\n        <h2>Archivos subidos por colaboradores</h2>\n        Pulse encima del archivo para descargar\n        <br /><br />\n        <v-row dense>\n          <v-col\n            class=\"mb-5\"\n            cols=\"2\"\n            v-for=\"(archivo, index) in archivosSubidos\"\n            :key=\"index\"\n          >\n\n            <v-card class=\"archivo shadowHover\">\n              <v-btn\n                v-if=\"\n                  archivo.idSubidoPor == $dataUser[0].id ||\n                  $dataUser[0].idRol == 3\n                \"\n                color=\"pink\"\n                fab\n                dark\n                small\n                absolute\n                top\n                left\n                @click=\"eliminarArchivo(archivo.id)\"\n              >\n                <v-icon>mdi-close</v-icon>\n              </v-btn>\n              <div @click=\"descargarArchivos(archivo.archivo)\" class=\"\">\n                <v-icon size=\"100px\"> mdi-file-chart </v-icon>\n                <br />\n                {{ archivo.archivo.split(\"/\")[3] }}\n                <br />\n                <h6>Fecha subida: {{ archivo.creado }}</h6>\n                <h6>Subido por: {{ archivo.subidoPor }}</h6>\n              </div>\n            </v-card>\n          </v-col>\n        </v-row>\n      </v-container>\n    </FullBoxVue>\n\n    <MiddleBox class=\"shadowHover\">\n      <v-form>\n        <v-container>\n          <v-row>\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                v-model=\"infoSolicitud.id\"\n                label=\"Id\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                v-model=\"infoSolicitud.CentroCostos\"\n                label=\"Centro de costos\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                :value=\"infoSolicitud.NOMBRE_SERVICIO\"\n                label=\"Nombre servicio\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                :value=\"infoSolicitud.NOMBRE_SUBSERVICIO\"\n                label=\"Nombre subservicio\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                :value=\"infoSolicitud.NOMBRE_CIUDAD\"\n                label=\"Nombre ciudad\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                :value=\"infoSolicitud.NOMBRE_DEPARTAMENTO\"\n                label=\"Nombre departamento\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                :value=\"infoSolicitud.nombreCliente\"\n                label=\"Nombre cliente\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                :value=\"infoSolicitud.nombreEmpresa\"\n                label=\"Nombre empresa\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                :value=\"infoSolicitud.estado\"\n                label=\"Estado de la solicitud\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n          </v-row>\n        </v-container>\n      </v-form>\n    </MiddleBox>\n\n    <MiddleBox class=\"shadowHover\">\n      <h2>Candidato(s)</h2>\n      <v-form\n        v-for=\"(candidato, index) in infoSolicitudCandidatos\"\n        :key=\"index\"\n      >\n        <v-container>\n          <v-row>\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                v-model=\"candidato.tipo_doc\"\n                label=\"Tipo documento\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                v-model=\"candidato.numTelefonico\"\n                label=\"Número telefónico\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                v-model=\"candidato.correo\"\n                label=\"Correo\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" sm=\"12\">\n              <v-text-field\n                v-model=\"candidato.observaciones\"\n                label=\"Observaciones\"\n                readonly\n                filled\n              ></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" sm=\"12\" v-if=\"candidato.archivo != ''\">\n              <v-btn\n                color=\"success\"\n                @click=\"descargarArchivos(candidato.archivo)\"\n                >Descargar archivo adjunto</v-btn\n              >\n            </v-col>\n            <v-col cols=\"12\" sm=\"12\" v-else>\n              Este candidato no cuenta con archivos\n            </v-col>\n          </v-row>\n        </v-container>\n      </v-form>\n    </MiddleBox>\n  </div>\n</template>\n\n<script>\nimport FullBoxVue from \"../components/static/FullBox.vue\";\nimport MiddleBox from \"@/components/static/MiddleBox.vue\";\nimport searchUserMultipleVue from \"../components/searchUserMultiple.vue\";\n\nimport {\n  getPeticion,\n  getCandidatos,\n  downloadFile,\n  getArchivos,\n  subirArchivos,\n  eliminarArchivos,\n  getFunProv,\n  updateEncargadoSolicitud,\n  getEstadosPeticiones,\n  updateEstadoSolicitud,\n} from \"@/api\";\n\nexport default {\n  data() {\n    return {\n      infoSolicitud: {},\n      infoSolicitudCandidatos: {},\n      componentKey: 1,\n      estadoSolicitud: null,\n      estados: null,\n      idSolicitud: this.$route.params.id,\n      archivosSubidos: [],\n      Images: null,\n      valido: false,\n      userSearchSelected: [],\n      userSearch: [],\n    };\n  },\n\n  components: {\n    FullBoxVue,\n    MiddleBox,\n    searchUserMultipleVue,\n  },\n\n  methods: {\n    actualizarEncargado() {\n      let bodySol = {\n        idEncargado: this.userSearchSelected,\n        idSolicitud: this.idSolicitud,\n      };\n      updateEncargadoSolicitud(bodySol).then(function (response) {}.bind(this));\n    },\n\n    actualizarEstadoSolicitud() {\n      let bodySol = {\n        idEstado: this.estadoSolicitud,\n        idSolicitud: this.idSolicitud,\n      };\n      updateEstadoSolicitud(bodySol).then(function (response) {}.bind(this));\n    },\n\n    userSearchSelectedFunc(values) {\n      this.userSearchSelected = values;\n    },\n\n    uploadFile() {\n      this.Images = this.$refs.file.files[0];\n    },\n\n    eliminarArchivo(id) {\n      eliminarArchivos(id).then(\n        function (response) {\n          console.log(response.data)\n          this.realizarConsultaArchivos();\n        }.bind(this)\n      );\n    },\n\n    realizarConsulta() {\n      getPeticion(this.idSolicitud).then(\n        function (response) {\n          this.infoSolicitud = response.data;\n          this.estadoSolicitud = this.infoSolicitud.idEstado;\n          this.componentKey += 1;\n        }.bind(this)\n      );\n    },\n\n    realizarConsultaEstados() {\n      getEstadosPeticiones().then(\n        function (response) {\n          this.estados = response.data;\n        }.bind(this)\n      );\n    },\n\n    realizarConsultaCandidatos() {\n      getCandidatos(this.idSolicitud).then(\n        function (response) {\n          this.infoSolicitudCandidatos = response.data;\n          this.componentKey += 1;\n        }.bind(this)\n      );\n    },\n\n    realizarConsultaArchivos() {\n      getArchivos(this.idSolicitud).then(\n        function (response) {\n          this.archivosSubidos = response.data;\n        }.bind(this)\n      );\n    },\n\n    subirArchivo() {\n      const formData = new FormData();\n      formData.append(\"file\", this.Images);\n      formData.append(\"idSolicitud\", this.idSolicitud);\n\n      subirArchivos(formData).then(\n        function (response) {\n          const Toast = this.$swal.mixin({\n            toast: true,\n            position: \"top-end\",\n            showConfirmButton: false,\n            timer: 3000,\n            timerProgressBar: true,\n            didOpen: (toast) => {\n              toast.addEventListener(\"mouseenter\", this.$swal.stopTimer);\n              toast.addEventListener(\"mouseleave\", this.$swal.resumeTimer);\n            },\n          });\n          Toast.fire({\n            icon: \"success\",\n            title: \"Solicitud enviada exitosamente\",\n          });\n          this.realizarConsultaArchivos();\n        }.bind(this)\n      );\n    },\n\n    descargarArchivos(filepath) {\n      downloadFile(filepath).then((response) => {\n        console.log(response.data)\n        let fileName = filepath.split(\"/\")[3];\n        const url = window.URL.createObjectURL(new Blob([response.data]));\n        const link = document.createElement(\"a\");\n        link.href = url;\n        link.setAttribute(\"download\", fileName);\n        document.body.appendChild(link);\n        link.click();\n      });\n    },\n  },\n\n  mounted() {\n    getFunProv().then(\n      function (response) {\n        this.userSearch = response.data;\n      }.bind(this)\n    );\n    this.realizarConsulta();\n  },\n\n  watch: {\n    infoSolicitud(newState) {\n      if (newState != {}) {\n        this.valido = true;\n        this.realizarConsultaCandidatos();\n        this.realizarConsultaArchivos();\n        this.realizarConsultaEstados();\n      }\n    },\n  },\n};\n</script>\n\n<style>\n.archivo {\n  min-width: 150px;\n  min-height: 170px;\n}\n\n.archivo:hover {\n  background: #385da6;\n  color: #fff;\n}\n\n.archivo:hover > div > i {\n  color: #fff;\n}\n.archivo:hover > div {\n  cursor: pointer;\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}